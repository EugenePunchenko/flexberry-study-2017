<%--flexberryautogenerated="true"--%>

<%@ Page Language="C#" MasterPageFile="~/Site1.Master" AutoEventWireup="true" CodeBehind="GruppaE.aspx.cs" Inherits="NewPlatform.RecordBookBL.ГруппаE" %>

<%@ Import Namespace="NewPlatform.Flexberry.Web.Page" %>
<%-- Autogenerated section start [Register] --%>
<%-- Autogenerated section end [Register] --%>

<asp:Content ID="Content1" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div class="<%= Constants.FormCssClass %> <%= Constants.EditFormCssClass %>">
        <h2 class="<%= Constants.FormHeaderCssClass %> <%= Constants.EditFormHeaderCssClass %>">Группа</h2>
        <div class="<%= Constants.FormToolbarCssClass %> <%= Constants.EditFormToolbarCssClass %> <%= Constants.StickyCssClass %>">
            <asp:ImageButton ID="SaveBtn" runat="server" SkinID="SaveBtn" OnClick="SaveBtn_Click" AlternateText="<%$ Resources: Resource, Save %>" ValidationGroup="savedoc" />
            <asp:ImageButton ID="SaveAndCloseBtn" runat="server" SkinID="SaveAndCloseBtn" OnClick="SaveAndCloseBtn_Click" AlternateText="<%$ Resources: Resource, Save_Close %>" ValidationGroup="savedoc" />
            <asp:ImageButton ID="CancelBtn" runat="server" SkinID="CancelBtn" OnClick="CancelBtn_Click" AlternateText="<%$ Resources: Resource, Cancel %>" />
        </div>
        <div class="<%= Constants.FormControlsCssClass %> <%= Constants.EditFormControlsCssClass %>">
            <%-- Autogenerated section start [Controls] --%>
            <!-- autogenerated start -->
            <div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlНазваниеLabel" runat="server" Text="Название" EnableViewState="False">
                    </asp:Label>
                    <asp:TextBox CssClass="descTxt" ID="ctrlНазвание" runat="server">
                    </asp:TextBox>

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlФакультетLabel" runat="server" Text="Факультет" EnableViewState="False">
                    </asp:Label>
                    <ac:MasterEditorAjaxLookUp ID="ctrlФакультет" CssClass="descTxt" runat="server" ShowInThickBox="True" Autocomplete="true" />

                    <asp:RequiredFieldValidator ID="ctrlФакультетValidator" runat="server" ControlToValidate="ctrlФакультет"
                        ErrorMessage="Не указано: Факультет" EnableClientScript="true" ValidationGroup="savedoc">*</asp:RequiredFieldValidator>

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlФакультет_НазваниеLabel" runat="server" Text="Название" EnableViewState="False">
                    </asp:Label>
                    <asp:TextBox CssClass="descTxt" ID="ctrlФакультет_Название" runat="server" ReadOnly="true">
                    </asp:TextBox>

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlСтаростаLabel" runat="server" Text="Староста" EnableViewState="False">
                    </asp:Label>
                    <ac:MasterEditorAjaxLookUp ID="ctrlСтароста" CssClass="descTxt" runat="server" ShowInThickBox="True" Autocomplete="true" />

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlСтароста_ФамилияLabel" runat="server" Text="Фамилия" EnableViewState="False">
                    </asp:Label>
                    <asp:TextBox CssClass="descTxt" ID="ctrlСтароста_Фамилия" runat="server" ReadOnly="true">
                    </asp:TextBox>

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlСпециальностьLabel" runat="server" Text="Специальность" EnableViewState="False">
                    </asp:Label>
                    <ac:MasterEditorAjaxLookUp ID="ctrlСпециальность" CssClass="descTxt" runat="server" ShowInThickBox="True" Autocomplete="true" />

                    <asp:RequiredFieldValidator ID="ctrlСпециальностьValidator" runat="server" ControlToValidate="ctrlСпециальность"
                        ErrorMessage="Не указано: Специальность" EnableClientScript="true" ValidationGroup="savedoc">*</asp:RequiredFieldValidator>

                </div>
                <div class="clearfix">
                    <asp:Label CssClass="descLbl" ID="ctrlКоличествоСтудентовLabel" runat="server" Text="Количество студентов" EnableViewState="False">
                    </asp:Label>
                    <ac:AlphaNumericTextBox CssClass="descTxt" ID="ctrlКоличествоСтудентов" Type="Numeric" Enabled="False" runat="server">
                    </ac:AlphaNumericTextBox>

                </div>
                <asp:ScriptManager ID="ScriptManager1" runat="server">
                </asp:ScriptManager>

                <div style="clear: left">
                    <ac:AjaxGroupEdit ID="ctrlСтуденты" runat="server" ReadOnly="false" />
                </div>

            </div>
            <!-- autogenerated end -->
            <%-- Autogenerated section end [Controls] --%>
        </div>
    </div>
</asp:Content>
<asp:Content runat="server" ContentPlaceHolderID="ContentPlaceHolder0">
    <script type="text/javascript">
        function getNumberOfStudents() {
            var data = $('#<%= ctrlСтуденты.ClientID %>').ajaxgroupedit('getDataRows');
            return data.length;
        }

        function changeFIO(e) {
            var surname = $(e.target).parents('tr').first().find('td:nth-child(6) input[id*="ctrlФамилия"]').val();
            var name = $(e.target).parents('tr').first().find('td:nth-child(7) input[id*="ctrlИмя"]').val();
            var patronymic = $(e.target).parents('tr').first().find('td:nth-child(8) input[id*="ctrlОтчество"]').val();
            $(e.target).parents('tr').first().find('td:nth-child(11) span[id*="ctrlФИО"]')
                .text(surname + ' ' + name + ' ' + patronymic);
        }

        $(function () {
            $('#<%= ctrlСтуденты.ClientID %> input[id*="ctrlНомерЗачетки"]').prop('disabled', true);

            $('#<%= ctrlСтуденты.ClientID %>').on('rowadded.ajaxgroupedit',
                function (e, d) {
                    $(d).find('input[id*="ctrlНомерЗачетки"]').prop('disabled', true);
                    $('#<%= ctrlКоличествоСтудентов.ClientID %>').val(getNumberOfStudents());
                });

            $('#<%= ctrlСтуденты.ClientID %>').on('rowdeleted.ajaxgroupedit',
                function (e, d) {
                    $('#<%= ctrlКоличествоСтудентов.ClientID %>').val(getNumberOfStudents());
                });

            $('#<%= ctrlСтуденты.ClientID %> input[id*="ctrlФамилия"]').change(function (e) {
                changeFIO(e);
            });

            $('#<%= ctrlСтуденты.ClientID %> input[id*="ctrlИмя"]').change(function (e) {
                changeFIO(e);
            });

            $('#<%= ctrlСтуденты.ClientID %> input[id*="ctrlОтчество"]').change(function (e) {
                changeFIO(e);
            });
        });
    </script>
</asp:Content>
